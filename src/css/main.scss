// TODO:
@import "webfonts";

$grey: hsl(0,0%,28%);
$blue: hsl(188,89%,44%);

$tablet: 590px;
$desktop: 900px;

$gutter-width: 1.25rem;
$trailing-margin-height: 1.2rem;

@function hundred-percent-from($value, $percent) {
    @return $value / ($percent / 100);
}

@function percent-of($value, $percent) {
    @return $value * ($percent / 100);
}

@mixin vw-range($property, $percent, $min, $max) {
    // Min
    #{$property}: $min;

    @include breakpoint($min/$percent * 100) {
        #{$property}: #{$percent}vw;
    }

    @include breakpoint($max/$percent * 100) {
        #{$property}: $max;
    }
}

@mixin font-size($p, $min, $max) {
    @include vw-range(font-size, $p, $min, $max);
}

@mixin width($p, $min, $max) {
    @include vw-range(width, $p, $min, $max);
}

@mixin grid($unit) {
    .l-#{$unit}-grid {
        display: flex;
        flex-wrap: wrap;
        // Account for first gutter
        margin-left: -$gutter-width;
    }

    .l-#{$unit}-grid--1of2 > .l-#{$unit}-grid-cell {
        // We have to use `width` instead of `flex-basis` because we don't want
        // rows that don't wrap to have their children flex grow.
        width: 50%;
        flex: none;
        margin-bottom: $gutter-width;

        &:last-child,
        &:nth-last-child(2):nth-child(odd) {
            margin-bottom: 0;
        }
    }

    .l-#{$unit}-grid--flex-cells > .l-#{$unit}-grid-cell {
        display: flex;

        & > * {
            flex: 1;
        }
    }

    .l-#{$unit}-grid-cell {
        flex-grow: 1;
        flex-basis: 0;
        padding-left: $gutter-width;
        // Unset
        margin-bottom: 0;
    }

    .l-#{$unit}-2of3 {
        width: 66.666%;
        flex: none;
    }

    .l-#{$unit}-1of3 {
        width: 33.333%;
        flex: none;
    }
}

// When collapsed, we apply trailing margins to the cells (except the last).
.l-grid-cell {
    margin-bottom: $trailing-margin-height;

    &:last-child {
        margin-bottom: 0;
    }
}

.l-grid--collapse {
    & > .l-grid-cell {
        margin-bottom: 0;
    }
}

@mixin breakpoint($size) {
    @if (true) {
    // @if (false) {
        // FIXME: Arbitrary number
        @media (min-width: $size) {
            @content;
        }
    }
}

// .content {
//     background: hsl(0,0%, 85%);

//     .content {
//         background: hsl(0,0%, 75%);

//         .content {
//             background: hsl(0,0%, 65%);
//         }
//     }
// }

@mixin inset() {
    @include breakpoint($desktop) {
        min-width: $desktop;
        width: 95vw;
        max-width: 1110px;
        margin-left: auto;
        margin-right: auto;
    }
}

// TODO: Do we want to do this for everything?
* {
    box-sizing: border-box;
}

.base-list {
    list-style: none;
    padding-left: 0;
}

.hidden {
    display: none
}

.inset {
    @include inset();
}

body {
    // Unset
    margin: 0;
    font-family: "EgyptianText", serif;
    -webkit-font-smoothing: antialiased;
    text-rendering: optimizeLegibility;
    color: hsl(0, 0%, 13%);
    line-height: 1.5;
}

// TODO: Mimic NGW
a {
    color: darken($blue, 18%);

    &:hover {
        text-decoration: underline;
    }
}

h1 {
    font-family: "EgyptianHeadline", serif;
    font-weight: normal;

    a {
        text-decoration: none;
    }
}

.h3 {
    @extend .dotted-top;
    font-size: 1.3rem;
    font-weight: bold;
}

.alt-h3 {
    font-size: 1.3rem;
    font-weight: normal;
    margin-bottom: 0;
}

section {
    h1 {
        font-size: 3.5rem;
    }

    section {
        h1 {
            font-size: 2rem;
            line-height: 1.3;
        }

        article,
        section {
            h1 {
                @extend .h3;
            }
        }
    }
}

h1,
p,
ul {
    // Unset
    margin-top: 0;
}

h1,
p,
ul,
.l-grid,
.trailing-margin {
    margin-bottom: $trailing-margin-height;

    &:last-child {
        margin-bottom: 0;
    }
}

.sans-serif {
    font-family: "AgateSans", sans-serif;
}

.cta-link {
    @extend .sans-serif;
    // TODO: Add bold sans-serif
    // font-weight: bold;
}

.dotted-top {
    border-top: 1px dotted $blue;
}

.dotted-top--white {
    border-top-color: white;
}

%white-text {
    &,
    a {
        color: white;
    }
}

.island {
    padding: $gutter-width;
}

.blue-widget {
    @extend %white-text;
    background-color: $blue;
}

.grey-widget {
    @extend %white-text;
    background-color: $grey;
}

iframe,
img {
    max-width: 100%;
}

.header {
    @extend .grey-widget;
    border-top: 4px solid $blue;
}

.header__inner {
    @extend .island;
    @include inset();

    @include breakpoint($desktop) {
        padding-top: 2rem;
        padding-bottom: 2rem;
    }
}

nav {
    @extend .dotted-top;
    text-transform: lowercase;
    font-size: 18px;

    & > ul {
        @extend .base-list;

        & > li > a {
            display: block;
            text-decoration: none;
            // Account for active border
            padding-top: 2px;

            @include breakpoint($desktop) {
                // Account for active border
                padding-top: 1px;
            }

            &:hover {
                text-decoration: underline;
            }

            &.active {
                border-top: 2px solid $blue;
                // Account for active border
                margin-top: -2px;

                @include breakpoint($desktop) {
                    // Account for active border
                    margin-top: -1px;
                    // Unset
                    padding-top: 0;
                }
            }
        }
    }
}

.video {
    position: relative;
}

@mixin fix-aspect-ratio($width, $height, $startingWidth: 100%) {
    // To get this working, position the child element
    // to 'absolute' in the top left corner
    $height: ($height / $width) * $startingWidth;
    width: $startingWidth;
    padding-bottom: $height;
    position: relative;
    overflow: hidden;
}

.video__placeholder {
    // Temp
    @include fix-aspect-ratio(500px, 281px);
}

.video__iframe {
    width: 100%;
    height: 100%;
    position: absolute;
    top: 0;
}

@include grid(default);

@include breakpoint($tablet) {
    @include grid(tablet);
}

@include breakpoint($desktop) {
    @include grid(desktop);
}

$x: 650px;

.main-image-container {
    @extend .trailing-margin;

    @include breakpoint($x) {
        position: relative;
        padding-bottom: $trailing-margin-height;
    }
}

.main-image {
    // TODO: Polyfill for FF, IE11, Safari
    object-fit: cover;
    height: 50vmin;
    min-height: 40vmax;
    @include breakpoint($desktop) {
        min-height: 30vmax;
    }
    // Reset â€“ by default the aspect ratio is maintained
    width: 100%;

    @include breakpoint($desktop) {
        // Reset
        height: 60vmin;
    }
}

.main-image-overlay {
    @include breakpoint($x) {
        position: absolute;
        bottom: 0;
        width: 100%;
    }
}

.main-image-overlay-inner {
    // TODO: Inherit minimum font size
    $min-heading-font-size: 2.25rem;
    $max-heading-font-size: 3.25rem;
    $heading-vw-width: 4;

    $vw-width: 54;
    $min-width: percent-of(hundred-percent-from($min-heading-font-size, $heading-vw-width), $vw-width);
    $max-width: percent-of(hundred-percent-from($max-heading-font-size, $heading-vw-width), $vw-width);
    @include breakpoint($x) {
        @include width($vw-width, $min-width, $max-width);
    }

    h1 {
        @include font-size($heading-vw-width, $min-heading-font-size, $max-heading-font-size);
    }

    p {
        @include font-size(2, 1rem, 1.3rem);
    }
}

.foo {
    $x: 50;
    $y: hundred-percent-from(2rem, 4);
    // max-width: percent-of($y, $x);

    @include breakpoint($desktop) {
        @include font-size(3, 2rem, 2.25rem);
        @include width($x,
            percent-of($y, $x),
            percent-of(hundred-percent-from(2.25rem, 4), $x))
    }
}

.large-text {
    font-size: 1.5rem;
}

.page-intro {
    @extend .header__inner;
    @extend .large-text;
    // Hack: make this look like it's part of the header
    // Could this be done better?
    padding-top: 0;
}

.bubble {
    width: 3.5rem;
    height: 3.5rem;
    border-radius: 50%;
    color: hsl(0, 100%, 100%);
    background-color: #ccc;
    // Take into account font size, line height, to calculate vertical padding
    // TODO: Use variables
    // (((16*3.5)-(16*1.5))/2)/16
    padding-top: 1rem;
    padding-bottom: 1rem;
    text-align: center;
}

.u-block {
    display: block;
}

// Component?
.footer {
    font-size: 0.875rem;
    color: hsl(0, 0%, 50%);
}

.developer-blog-section {
    article {
        h1 {
            margin-bottom: 0;
        }

        time {
            display: block;
            margin-bottom: 1rem;
            color: hsl(0, 0%, 50%);
        }
    }
}

.media {
    overflow: hidden;
}

.media__img {
    float: left;
    margin-right: 1rem;
}

.media__body {
    overflow: hidden;
}
